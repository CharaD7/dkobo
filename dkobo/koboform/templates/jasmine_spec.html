{% extends "base.html" %}
{% block title %}Jasmine Spec{% endblock %}
{% load staticfiles %}
{% load compress %}
{% block head %}
  <link rel="stylesheet" href="{% static 'components/jasmine/lib/jasmine-core/jasmine.css' %}" />
  <script type="text/javascript" src="{% static 'components/jasmine/lib/jasmine-core/jasmine.js' %}"></script>
  <script type="text/javascript" src="{% static 'components/jasmine/lib/jasmine-core/jasmine-html.js' %}"></script>
  <script type="text/javascript" src="{% static 'components/sinonjs/sinon.js' %}"></script>
  <script type="text/javascript" src="{% static 'components/jasmine-sinon/lib/jasmine-sinon.js' %}"></script>
  <script type="text/javascript" src="{% static 'components/jquery/dist/jquery.js' %}"></script>
  <script type="text/javascript" src="{% static 'components/jquery-migrate/jquery-migrate.js' %}"></script>

  {% compress js %}
  <script type="text/coffeescript" src="{% static 'js/log.coffee' %}"></script>
  {% endcompress %}

  <script src="{% static 'js/jquery.poshytip.js' %}"></script>
  <link rel="stylesheet" href="{% static 'kobo.compiled/kobo.css' %}">

  <script src="{% static 'components/requirejs/require.js' %}"></script>
{% endblock %}
{% block foot %}
  <script type="text/javascript">
    (function() {
      var jasmineEnv = jasmine.getEnv();
      jasmineEnv.updateInterval = 1000;

      var trivialReporter = new jasmine.TrivialReporter();

      jasmineEnv.addReporter(trivialReporter);

      jasmineEnv.specFilter = function(spec) {
        return trivialReporter.specFilter(spec);
      };
      
      require.config({ baseUrl: '{% static '' %}' });

      require(['test/components'], function(components){
        var k, v, paths = {};
        for (k in components.dirPaths) {
          paths[k] = components.dirPaths[k]
        }
        for (k in components.libs) {
          paths[k] = components.libs[k].replace(/\.js$/, '');
        }
        require.config({
          paths: paths
        });
        require(['cs!test/amdrunner'], execJasmine);
      });

      function execJasmine() {
        jasmineEnv.execute();
      }

    })();
  </script>

{% endblock %}